# 活動統計儀表板

這是一個使用 React + Material UI 建立的活動統計儀表板，可以上傳 Excel 檔案並產生各種統計圖表。

## 功能特色

- 📊 上傳 Excel 檔案並自動解析資料
- 📅 支援多種日期格式自動解析（包括日期範圍和中文括號）
- 🎯 自動過濾取消的活動
- 👥 支援人名別名映射，自動合併相同人員的不同寫法
- 📈 產生 14 種不同的統計圖表
- 🎨 統一的顏色配置和排序邏輯

## 安裝與執行

### 安裝依賴

```bash
npm install
```

### 開發模式

```bash
npm run dev
```

### 建置生產版本

```bash
npm run build
```

### 預覽生產版本

```bash
npm run preview
```

## 使用說明

1. 開啟網頁後，點擊「選擇檔案」按鈕
2. 選擇「手作步道活動助教人力需求表.xlsx」檔案
3. 系統會自動讀取「2025」工作表的資料
4. 解析完成後，會顯示 14 個統計圖表

## 統計圖表說明

### 依活動類型統計（圖表 1-4）

1. **各月份活動次數統計（依活動類型）** - Stack 柱狀圖
2. **各月份活動天數統計（依活動類型）** - Stack 柱狀圖
3. **依活動類型統計次數** - 圓餅圖（左）
4. **依活動類型統計天數** - 圓餅圖（右）

### 依縣市統計（圖表 5-8）

5. **各月份活動次數統計（依縣市）** - Stack 柱狀圖
6. **各月份活動天數統計（依縣市）** - Stack 柱狀圖
7. **依縣市統計次數** - 圓餅圖（左）
8. **依縣市統計天數** - 圓餅圖（右）

- 縣市排序：按照北中南東的順序排列，未分類放在最後
- 圖例順序：與柱狀圖一致，按北中南東排列

### 依地區統計（圖表 9-12）

9. **各月份活動次數統計（依地區）** - Stack 柱狀圖
10. **各月份活動天數統計（依地區）** - Stack 柱狀圖
11. **依地區統計次數** - 圓餅圖（左）
12. **依地區統計天數** - 圓餅圖（右）

- 地區分類：北部、中部、南部、東部、未分類
- 顏色配置：北部（藍紫色）、中部（綠色）、南部（黃色）、東部（橙色）、未分類（灰色）

### 參與人員統計（圖表 13-14）

13. **參與人員活動次數統計** - 柱狀圖（分成上下兩部分，以中位數切開）
14. **參與人員活動時數統計** - 柱狀圖（分成上下兩部分，以中位數切開）

- 人名會使用別名映射自動合併
- 當人名過多時，會自動分成上下兩個圖表顯示，方便閱讀

## Excel 檔案格式要求

- 必須包含名為「2025」的工作表
- 欄位位置：
  - **A 欄**：日期（支援多種格式，見下方說明）
  - **B 欄**：活動名稱
  - **C 欄**：辦理情形（包含「取消」的活動會被自動過濾）
  - **D 欄**：天數
  - **E 欄**：活動類型
  - **G 欄**：縣市
  - **N 欄**：可登錄時數
  - **Q 欄**：服勤區（人名，支援多種分隔符）

### 日期格式支援

系統支援以下日期格式：
- 單一日期：`1/3`、`11/21` → 解析為 2025/1/3、2025/11/21
- 日期範圍：`1/3-5` → 2025/1/3 至 2025/1/5（使用開始日期統計）
- 日期範圍：`11/21-11/25` → 2025/11/21 至 2025/11/25
- 包含星期：`11/9（日）`、`1/3(一)` → 自動移除括號內容

### 服勤區人名格式

服勤區欄位支援以下分隔符：
- 頓號：`張三、李四、王五`
- 中文逗號：`張三，李四，王五`
- 英文逗號：`張三,李四,王五`
- 換行符：多行分隔

## 人名別名映射

系統支援人名別名映射功能，可以將相同人員的不同寫法合併統計。

### 設定別名

1. 執行 `node extractNames.js` 提取所有人名
2. 編輯 `nameAliases.json` 檔案
3. 將相同人員的別名設定為相同的標準名稱

例如：
```json
{
  "Lingo": "Lingo",
  "lingo": "Lingo",
  "陳宏構": "Lingo",
  "傑仁": "傑仁",
  "傑仁(8/2-8/3)": "傑仁"
}
```

### 提取人名腳本

```bash
node extractNames.js
```

此腳本會：
- 讀取 Excel 檔案中的服勤區欄位
- 提取所有不重複的人名
- 生成 `nameAliases.json` 檔案供編輯

## 技術棧

- **React 18** - UI 框架
- **Material UI 5** - UI 元件庫
- **Recharts** - 圖表庫
- **ExcelJS** - Excel 檔案解析
- **Vite** - 建置工具

## 專案結構

```
activityStatistics/
├── src/
│   ├── components/
│   │   ├── ExcelUploader.jsx      # Excel 上傳元件
│   │   └── StatisticsCharts.jsx   # 統計圖表元件
│   ├── utils/
│   │   ├── dateParser.js          # 日期解析工具
│   │   ├── excelParser.js         # Excel 解析工具
│   │   ├── dataProcessor.js       # 資料處理和統計計算
│   │   └── nameAliases.js         # 人名別名映射工具
│   ├── App.jsx                    # 主應用元件
│   └── main.jsx                   # 應用入口
├── nameAliases.json               # 人名別名映射設定檔
├── extractNames.js                # 人名提取腳本
└── package.json
```

## 注意事項

- 日期預設年份為 2025 年
- 辦理情形包含「取消」的活動會被自動過濾
- 縣市和地區的排序遵循：北部 → 中部 → 南部 → 東部 → 未分類
- 人名統計會自動使用別名映射合併相同人員
- 當參與人員過多時，圖表會自動分成上下兩部分顯示

